<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Mage Jump</title>
<style>
  html, body { margin:0; padding:0; background:#0b0e1a; color:#fff; height:100%; overflow:hidden; font-family:sans-serif; }
  #game { display:block; width:100vw; height:100vh; touch-action:none; }
  .hud { position:fixed; top:8px; left:8px; right:8px; display:flex; justify-content:space-between; pointer-events:none; font-weight:bold; }
  .panel { position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0.35); backdrop-filter:blur(2px); visibility:hidden; opacity:0; transition:opacity .25s; }
  .panel.show { visibility:visible; opacity:1; }
  .card { background:rgba(12,14,28,0.9); border-radius:14px; padding:18px 20px; max-width:520px; }
  .btn { display:inline-block; padding:10px 16px; border-radius:10px; background:rgba(255,255,255,0.08); cursor:pointer; }
  .controls { position:fixed; bottom:12px; left:12px; right:12px; display:flex; justify-content:space-between; gap:12px; }
  .touchkey { width:26vw; max-width:200px; height:64px; border-radius:16px; background:rgba(255,255,255,0.08); display:grid; place-items:center; font-weight:bold; font-size:18px; user-select:none; }
  .touchkey.active { background:rgba(255,255,255,0.18); }
  @media (min-width:900px) { .controls { display:none; } }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="hud">
  <div id="score">Score: 0</div>
  <div id="level">Level: 1</div>
  <div id="best">Best: 0</div>
</div>
<div id="panel" class="panel show">
  <div class="card">
    <h1>Mage Jump</h1>
    <p>Arrow keys or A/D to move. Bounce on platforms, avoid enemies, grab boosts.</p>
    <div class="btn" id="start">Start</div>
  </div>
</div>
<div class="controls">
  <div class="touchkey" id="leftBtn">◀</div>
  <div class="touchkey" id="rightBtn">▶</div>
</div>
<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const bestEl = document.getElementById('best');
  const panel = document.getElementById('panel');
  const startBtn = document.getElementById('start');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  let W=0,H=0,DPR=1;
  const resize=()=>{DPR=Math.min(window.devicePixelRatio||1,2);W=innerWidth;H=innerHeight;canvas.width=W*DPR;canvas.height=H*DPR;canvas.style.width=W+'px';canvas.style.height=H+'px';ctx.setTransform(DPR,0,0,DPR,0,0);};
  window.addEventListener('resize',resize);resize();

  const keys={left:false,right:false};
  const setKey=(k,v)=>keys[k]=v;
  window.addEventListener('keydown',e=>{if(['ArrowLeft','KeyA'].includes(e.code))setKey('left',true);if(['ArrowRight','KeyD'].includes(e.code))setKey('right',true);});
  window.addEventListener('keyup',e=>{if(['ArrowLeft','KeyA'].includes(e.code))setKey('left',false);if(['ArrowRight','KeyD'].includes(e.code))setKey('right',false);});
  const bindTouch=(el,key)=>{const on=()=>{el.classList.add('active');setKey(key,true);};const off=()=>{el.classList.remove('active');setKey(key,false);};el.onmousedown=on;el.onmouseup=off;el.ontouchstart=e=>{e.preventDefault();on();};el.ontouchend=off;};
  bindTouch(leftBtn,'left');bindTouch(rightBtn,'right');

  const game={over:true,score:0,best:Number(localStorage.getItem('magejump_best')||0),level:1,camY:0};
  bestEl.textContent='Best: '+game.best;

  const player={x:W/2,y:H*0.7,w:36,h:38,vx:0,vy:-12,gravity:0.38,bounce:11.5,jetpackTime:0};
  const platforms=[],enemies=[],boosts=[];
  const rand=(a,b)=>a+Math.random()*(b-a),irand=(a,b)=>Math.floor(rand(a,b+1)),clamp=(v,a,b)=>Math.max(a,Math.min(b,v));

  let platGapMin=55,platGapMax=95,fragilePlatChance=0.14,enemyChance=0.08,boostChance=0.1;
  function difficultyUpdate(){game.level=Math.max(1,Math.floor(game.score/450)+1);const t=Math.min(1,(game.level-1)/8);platGapMin=60+20*t;platGapMax=100+70*t;fragilePlatChance=(game.level>=5)?1.0:(0.14+0.6*t);enemyChance=0.08+0.12*t;boostChance=0.1-0.05*t;levelEl.textContent='Level: '+game.level;}

  function makePlatform(x,y,w){const typeRoll=Math.random();let type='solid';if(typeRoll<fragilePlatChance)type='fragile';const p={x,y,w,h:12,type,broken:false};if(Math.random()<boostChance&&type!=='fragile')boosts.push({x:p.x+p.w/2,y:p.y-14,r:10,type:Math.random()<0.5?'spring':'jetpack'});if(Math.random()<enemyChance)enemies.push({x:irand(0,W-60),y:p.y-100,w:irand(50,110),h:22,vx:Math.random()<0.5?0.8:-0.8});return p;}

  function initWorld(){platforms.length=0;enemies.length=0;boosts.length=0;let y=H-20;for(let i=0;i<16;i++){const pw=irand(60,110),px=irand(10,W-pw-10);platforms.push(makePlatform(px,y,pw));y-=irand(65,100);}platforms.slice(0,3).forEach(p=>p.type='solid');}

  function restart(){game.over=false;game.score=0;game.camY=0;player.x=W/2;player.y=H*0.7;player.vx=0;player.vy=-12;player.jetpackTime=0;difficultyUpdate();initWorld();panel.classList.remove('show');loopLast=performance.now();requestAnimationFrame(loop);}
  startBtn.onclick=()=>{if(game.over)restart();};

  let loopLast=performance.now();
  function loop(now){if(game.over)return;const dt=clamp((now-loopLast)/16.6667
